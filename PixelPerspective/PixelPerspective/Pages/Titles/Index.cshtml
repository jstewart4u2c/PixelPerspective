@page "{id:int}"
@model PixelPerspective.Pages.Titles.IndexModel

@{
    ViewData["Title"] = Model.Game?.Title ?? "Game Not Found";
}

<div class="game-container">
    <div class="game-cover">
        <img src="@Url.Content($"~/{Model.Game.ThumbnailImagePath}")" alt="@Model.Game.Title" class="game-thumbnail" />
    </div>

    <div class="game-info">
        <h1>@Model.Game.Title</h1>
        <!-- Display rating dynamically based on average score -->
        <div class="rating">
            @if (Model.TopReviews.Any())
            {
                var averageRating = Model.TopReviews.Average(r => r.Rating);
                var fullStars = Math.Floor(averageRating);  // Full stars based on the floor of the average
                var emptyStars = 5 - fullStars;  // Remaining stars

                @for (int i = 0; i < fullStars; i++)
                {
                    <span>★</span> <!-- Full star -->
                }
                @for (int i = 0; i < emptyStars; i++)
                {
                    <span>☆</span> <!-- Empty star -->
                }
                <span> (@Model.TopReviews.Count Reviews)</span>
            }
            else
            {
                <span>☆☆☆☆☆ <span>(0 Reviews)</span></span>
            }
        </div>
        <p><strong>Genre:</strong> @Model.Game.Genre</p>
        <p><strong>Release Date:</strong> @Model.Game.ReleaseDate.ToString("MMMM dd, yyyy")</p>
        <p><strong>Description:</strong> @Model.Game.Description</p>

        <div class="actions">
            <button class="add-to-library">+ Add to Library</button>
            <button class="share">🔄 Share</button>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.Game?.TrailerPath))
{
    <div class="game-trailer">
        <iframe width="560" height="315" src="https://www.youtube.com/embed/@Model.Game.TrailerPath" frameborder="0" allowfullscreen></iframe>
    </div>
}

<div class="write-review">
    <h2>Write a Review</h2>
    <div class="review-section">
        <div class="stars">
            ⭐⭐⭐⭐⭐
        </div>
        <textarea placeholder="Write your review here..."></textarea>
        <button type="submit">Submit</button>
    </div>
</div>

<div class="top-reviews">
    <h2>Top Reviews</h2>
    @if (Model.TopReviews.Any())
    {
        @foreach (var review in Model.TopReviews)
        {
            <div class="review">
                @if (!string.IsNullOrEmpty(review.User?.ProfileImagePath))
                {
                    <img src="@Url.Content($"~/{review.User.ProfileImagePath}")" alt="Review Media" class="review-media" />
                }
                <div class="review-content">
                    <strong>@review.User.UserName</strong>
                    <div>
                        @for (int i = 0; i < review.Rating; i++)
                        {
                            <span>⭐</span>
                        }
                    </div>
                    <p>@review.ReviewText</p>
                    <div class="review-actions">
                        👍 @review.Likes &nbsp; 👎 @review.Dislikes
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <p>@Model.NoReviewsMessage</p>
    }
</div>


<style>
    .game-thumbnail {
        width: 150px;
        height: 200px;
        object-fit: cover;
    }
</style>
