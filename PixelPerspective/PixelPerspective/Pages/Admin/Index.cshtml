@page
@model PixelPerspective.Pages.Admin.IndexModel

@{
    ViewData["Title"] = "Admin Page";
}

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
            <div class="position-sticky">
                <h4>Administration</h4>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" id="manage-users-tab" href="#" onclick="loadTab('users')">Manage Users</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="manage-games-tab" href="#" onclick="loadTab('games')">Manage Games</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="manage-reviews-tab" href="#" onclick="loadTab('reviews')">Manage Reviews</a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-4">
            <h1>@ViewData["Title"]</h1>

            <!-- Save Changes Button above the table, moved to the right -->
            <form method="post">
                <button type="submit" class="btn btn-primary mb-3 float-end">Save Changes</button>
                <div id="content-area">
                    <!-- Content will be dynamically injected here -->
                    <h3>Users</h3>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Admin</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model.Users)
                            {
                                <tr>
                                    <td>@user.UserName</td>
                                    <td>@user.Email</td>
                                    <td>@user.PhoneNumber</td>
                                    <td>
                                        <input type="checkbox" name="IsAdmin_@user.Id" @(user.IsAdmin.HasValue && user.IsAdmin.Value ? "checked" : "")>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger" onclick="confirmDelete('@user.Id')">Delete</button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </form>
        </main>
    </div>
</div>

<script>
       function confirmDelete(userId) {
        if (confirm("Are you sure you want to permanently delete this user?")) {
            // Use userId as string
            window.location.href = '/Admin?handler=DeleteUser&id=' + userId;
        }
    }

</script>


<script>
    function loadTab(tab) {
        let contentArea = document.getElementById("content-area");

        // Hide all content sections
        contentArea.innerHTML = '';

        if (tab === 'users') {
            contentArea.innerHTML = `
                <h3>Users</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Admin</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
    @foreach (var user in Model.Users)
    {
                                <tr>
                                    <td>@user.UserName</td>
                                    <td>@user.Email</td>
                                    <td>@user.PhoneNumber</td>
                                    <td>
                                        <input type="checkbox" name="IsAdmin_@user.Id" @(user.IsAdmin.HasValue && user.IsAdmin.Value ? "checked" : "")>
                                    </td>
                                    <td>
                                        <button type="button" class="btn btn-danger" onclick="confirmDelete('@user.Id')">Delete</button>
                                    </td>
                                </tr>
    }
                    </tbody>
                </table>
            `;
        } else if (tab === 'games') {
            contentArea.innerHTML = `
                <h3>Manage Games</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Release Date</th>
                            <th>Genre</th>
                        </tr>
                    </thead>
                    <tbody>
    @foreach (var game in Model.Games)
    {
                                <tr>
                                    <td>@game.Title</td>
                                    <td>@game.ReleaseDate.ToString("MMMM dd, yyyy")</td>
                                    <td>@game.Genre</td>
                                </tr>
    }
                    </tbody>
                </table>
            `;
        } else if (tab === 'reviews') {
            contentArea.innerHTML = `
                <h3>Manage Reviews</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Review Text</th>
                            <th>Rating</th>
                            <th>Game</th>
                        </tr>
                    </thead>
                    <tbody>
    @foreach (var review in Model.Reviews)
    {
                                <tr>
                                    <td>@review.ReviewText</td>
                                    <td>@review.Rating</td>
                                    <td>@Model.Games.FirstOrDefault(g => g.Id == review.GameId)?.Title</td>
                                </tr>
    }
                    </tbody>
                </table>
            `;
        }
    }

    // Default load tab
    loadTab('users');
</script>
